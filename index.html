<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>GeoAR.js demo</title>
    <script src='https://aframe.io/releases/0.9.2/aframe.min.js'></script>
    <script src="https://raw.githack.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script> <!-- CSV Parser -->
</head>
<body style='margin: 0; overflow: hidden;'>
    <a-scene
        vr-mode-ui="enabled: false"
        embedded
        arjs='sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: true;'>
        
        <!-- Camera -->
        <a-camera gps-camera rotation-reader></a-camera>
    </a-scene>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            fetch('ABG_Database_101124wSID_cleaned_112824_wHornbake.csv')
                .then(response => response.text())
                .then(csvData => {
                    Papa.parse(csvData, {
                        header: true,
                        skipEmptyLines: true,
                        complete: function(results) {
                            let scene = document.querySelector("a-scene");

                            results.data.forEach(row => {
                                let { s_id, cname1, cname2, cname3, genus, species, cultivar, longitude, latitude, Plants_On_Hornbake } = row;

                                // Trim values to prevent errors
                                longitude = longitude?.trim();
                                latitude = latitude?.trim();

                                if (!longitude || !latitude) return; // Skip rows with missing coordinates

                                let combinedName = [cname1, cname2, cname3, genus, species, cultivar]
                                    .filter(val => val && val.trim() !== "")
                                    .join(" ");
                                let latitude = 38.9823080;
                                let longitude = -76.9441525;
                                let combinedName = "here";

                                // Create a small circle as a marker
                                let circle = document.createElement("a-circle");
                                circle.setAttribute("gps-entity-place", `longitude: ${longitude}; latitude: ${latitude}`);
                                circle.setAttribute("radius", "0.5");
                                circle.setAttribute("color", "red");
                                circle.setAttribute("position", "0 1 -3");
                                circle.setAttribute("class", "plant-marker");

                                // Create a text box (hidden initially)
                                let textEntity = document.createElement("a-entity");
                                textEntity.setAttribute("gps-entity-place", `longitude: ${longitude}; latitude: ${latitude}`);
                                textEntity.setAttribute("text", `value: ${combinedName}; color: white; width: 6; align: center;`);
                                textEntity.setAttribute("position", "0 1.5 -3");
                                textEntity.setAttribute("visible", "false"); // Hidden by default

                                // Toggle text visibility when the circle is clicked
                                circle.addEventListener("click", () => {
                                    let isVisible = textEntity.getAttribute("visible");
                                    textEntity.setAttribute("visible", !isVisible);
                                });

                                scene.appendChild(circle);
                                scene.appendChild(textEntity);
                            });
                        }
                    });
                });
        });
    </script>
</body>
</html>
